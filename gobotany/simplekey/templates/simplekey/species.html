{% extends "simplekey/_new_base.html" %}
{% load simplekey_extras %}

{% block title %}{{ scientific_name }} 
({% for common_name in taxon.common_names.all %}{% if not forloop.first %}, {% endif %}{{ common_name }}{% endfor %}){% endblock %}

{% block body_attributes %}id="taxon" class="claro app taxon"{% endblock %}

{% block js_top %}
    {# SVGWeb script: must be first of all JS, must have data-path. #}
    {# Also, SVG must be served from same domain as the page. #}
    <script src="/static/svgweb/svg.js"
        data-path="/static/svgweb/"></script>

    {# TODO: eventually move elsewhere #}
    {% include "simplekey/_partner_site_js.html" %}

    <script>        
        API_URL = '{% url api-base %}';
    </script>
{% endblock %}

{% block js_require %}
    require(['simplekey/species']);
{% endblock %}

{% block body_content %}
    {% include "simplekey/_header.html" %}

    <div class="content">
        {% if not in_simple_key %}
            <div class="note">This is a species in our Full Key.
            Complete data are coming soon.</div>
        {% endif %}

        <div class="container">
            <div id="main">

                {# TODO: After implementing Full Key and navigation, #}
                {# show appropriate breadcrumb links.                #}
                {% if in_simple_key %}
                    <div id="breadcrumb">
                        <p class="nogloss">You are here: 
                        <a href="{% url simplekey %}">Simple Key</a>
                        &gt;
                        <a href="{% url simplekey-pilegroup pilegroup.slug %}"
                            >{{ pilegroup.friendly_title|lower|capfirst }}</a>
                        &gt; 
                        <a href="{% if last_plant_id_url and pile.slug in last_plant_id_url %}{{ last_plant_id_url }}{% else %}{% url simplekey-pile pilegroup.slug pile.slug %}{% endif %}"
                            >{{ pile.friendly_title|lower|capfirst }}</a>
                        &gt;
                        <span>{{ scientific_name|italicize_plant|safe }}
                           {# If the above is too long, can use scientific_name_short #}
                        </span></p>
                    </div>
                {% endif %}
                
                <h2>
                    <span class="scientific">
                        {{ scientific_name|italicize_plant|safe }}
                    </span>
                    <span class="origin">{{ taxon.taxonomic_authority }}</span>
                    <span class="common">
                        {% for common_name in taxon.common_names.all %}{% if not forloop.first %}, {% endif %}{{ common_name }}{% endfor %}
                    </span>
                </h2>

                <div id="species-images">
                    <div class="scrollingHotSpotLeft"></div>
		            <div class="scrollingHotSpotRight"></div>
		            <div class="scrollWrapper">
                        <div class="scrollableArea">
                            {% for i in images %}
                                <a href="{{ i.image_medium }}"
                                    {% if forloop.counter == 1 %}id="startimage"{% endif %}
                                    title="{% photo_credit i scientific_name %}">
                                    <img src="{{ i.thumb_large }}"
                                        alt="{% photo_credit i scientific_name %}">
                                </a>
                            {% endfor %}
			            </div>
		            </div>
                </div>
                <div class="clearit"></div>

                {% if partner_heading or partner_blurb %}
                  <h3>{{ partner_heading }}</h3>
                  <p>{{ partner_blurb }} </p>
                {% endif %}

                <h3>Facts About</h3>
                <p>
                    {% if taxon.factoid|length > 0 %}
                        {{ taxon.factoid }}
                    {% else %}
                        N/A
                    {% endif %}
                </p>
                
                <h3>Habitat</h3>
                <p>
                    {% if habitats|length > 0 %}
                        {{ habitats|join:", "|lower|capfirst }}
                    {% else %}
                        (missing)
                    {% endif %}
                </p>
                
                <h3>Characteristics</h3>
                <div class="characteristics">
                    {% if brief_characteristics %}
                        {% for character in brief_characteristics %}
                            <dl>
                                <dt>{{ character.name }}</dt>
                                <dd>
                                    {% if character.values|length_is:"1" %}
                                        {{ character.values.0 }}
                                    {% else %}
                                        <ul{% if character.name in compact_multivalue_characters %} class="compact"{% endif %}>
                                        {% for val in character.values %}
                                            <li{% if forloop.last %} class="last"{% endif %}>{{ val }}</li>
                                        {% endfor %}
                                        </ul>
                                    {% endif %}
                                </dd>
                            </dl>
                        {% endfor %}
                    {% else %}
                        <p>No “plant preview characters” have been established
                          for the “{{ pile.friendly_name }}” ({{ pile.name }})
                          pile.</p>
                    {% endif %}
                </div>
                <a class="description-control" href="#" 
                    style="background-image: url(/static/images/icons/plus.png)">Show 
                    All Characteristics</a>
                <ul class="full-description">
                    {% for character_group in all_characteristics %}
				        <li>
                            <h5>{{ character_group.name|capfirst }}</h5>
                            <div class="characteristics full">
                                {% for character in character_group.characters %}
                                <dl>
                                    <dt>{{ character.name }}</dt>
                                    <dd>
                                    {% if character.values|length_is:"1" %}
                                        {{ character.values.0 }}
                                    {% else %}
                                        <ul{% if character.name in compact_multivalue_characters %} class="compact"{% endif %}>
                                        {% for val in character.values %}
                                            <li{% if forloop.last %} class="last"{% endif %}>{{ val }}</li>
                                        {% endfor %}
                                        </ul>
                                    {% endif %}
                                    </dd>
                                </dl>
                                {% endfor %}
                            </div>
                        </li>
                    {% endfor %}
                </ul>
                
                <h3>Wetland Plant?</h3>
                <p>{{ taxon.wetland_status_text }}</p>
                
                <h3>New England Distribution and Conservation Status</h3>
                <table>
                    <thead>
                        <tr>
                            <td></td>
                            <th>Connecticut</th>
                            <th>Maine</th>
                            <th>Massachusetts</th>
                            <th>New Hampshire</th>
                            <th>Rhode Island</th>
                            <th>Vermont</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% collect taxon.conservation_status_ct taxon.conservation_status_me taxon.conservation_status_ma taxon.conservation_status_nh taxon.conservation_status_ri taxon.conservation_status_vt as statuses %}
                        <tr>
                            {% with 'present' as value %}
                                <th>{{ value|capfirst }}?</th>
                                {% for status in statuses %}
                                    <td>
                                        {% if value in status %}
                                            {{ value }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </td>
                                {% endfor %}
                            {% endwith %}
                        </tr>
                        <tr>
                            <th>Conservation Status:</th>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        {% collect 'endangered' 'threatened' 'special concern' 'historic' 'rare' 'extinct' 'invasive' 'prohibited' as status_values %}
                        {% for value in status_values %}
                            <tr>
                                <th class="status">{{ value|capfirst }}?</th>
                                {% for status in statuses %}
                                    <td>
                                        {% if value in status %}
                                            {{ value }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </td>
                                {% endfor %}
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>

            </div>

            <div id="sidebar" style="height: 1116px">
                <div class="section">
                    <h5>New England Distribution</h5>
                    <!--[if !IE]>-->
                    <object
                        data="/api/maps/{{taxon.genus|lower}}-{{specific_epithet}}-ne-distribution-map.svg"
                        type="image/svg+xml"
                        title="distribution map for {{ scientific_name }}"
                        id="ne-dist-county-map"> <!--<![endif]-->
                    <!--[if lt IE 9]>
                    <object
                        src="/api/maps/{{taxon.genus|lower}}-{{specific_epithet}}-ne-distribution-map.svg"
                        classid="image/svg+xml"
                        title="distribution map for {{ scientific_name }}"
                        id="ne-dist-county-map"> <![endif]-->
                    <!--[if gte IE 9]>
                    <object
                        data="/api/maps/{{taxon.genus|lower}}-{{specific_epithet}}-ne-distribution-map.svg"
                        type="image/svg+xml"
                        title="distribution map for {{ scientific_name }}"
                        id="ne-dist-county-map"> <![endif]-->
                    </object>
                </div>

                <div class="section namap">
                    <h5>North America Distribution</h5>
                    <div>
                        <object
                            data="/api/maps/{{taxon.genus|lower}}-{{specific_epithet}}-na-distribution-map.svg"
                            type="image/svg+xml"
                            title="distribution map for {{ scientific_name }}"
                            id="na-dist-county-map"> <!--<![endif]-->
                        <!--[if lt IE 9]>
                        <object
                            src="/api/maps/{{taxon.genus|lower}}-{{specific_epithet}}-na-distribution-map.svg"
                            classid="image/svg+xml"
                            title="distribution map for {{ scientific_name }}"
                            id="na-dist-county-map"> <![endif]-->
                        <!--[if gte IE 9]>
                        <object
                            data="/api/maps/{{taxon.genus|lower}}-{{specific_epithet}}-na-distribution-map.svg"
                            type="image/svg+xml"
                            title="distribution map for {{ scientific_name }}"
                            id="na-dist-county-map"> <![endif]-->
                        </object>
                    </div>
                    <div class="trans"></div>
                    <a class="enlarge" href="#">
                        <img src="/static/images/icons/zoom.png" alt="">
                        Click to enlarge</a>
                </div>

                <div class="section">
                    <h5>Native to North America?</h5>
                    {% if taxon.north_american_native %}
                        Yes.
                    {% else %}
                        No.
                    {% endif %}
                </div>

                {% if taxon.lookalikes.all|length > 0 %}
                <div class="section lookalikes">
                    <h5>Sometimes Confused With:</h5>
                    <dl>
                    {% for lookalike in taxon.lookalikes.all %}
                    <dt><a href="/species/{{ lookalike.lookalike_scientific_name|lower|replace:' ,/' }}/"><em>{{ lookalike.lookalike_scientific_name }}</em></a>:</dt>
                        <dd>{{ lookalike.lookalike_characteristic }}</dd>
                    {% endfor %}
                    </dl>
                </div>
                {% endif %}

                {% with taxon.synonyms.all as synonyms %}
                {% if synonyms|length > 0 %}
                <div class="section">
                    <h5>Synonyms:</h5>
                    <p>
                        {% for synonym in synonyms %}
                            {{ synonym.full_name|italicize_plant|safe }}{% if not forloop.last %},{% endif %}
                        {% endfor %}
                    </p>
                </div>
                {% endif %}
                {% endwith %}

                <div class="section">
                    <h5>Family:</h5>
                    <p><a href="{% url simplekey-family taxon.family.slug %}"
                        >{{ taxon.family }}</a></p>
                </div>

                <div class="section">
                    <h5>Genus:</h5>
                    <p><em><a href="{% url simplekey-genus taxon.genus.slug %}"
                        >{{ taxon.genus }}</a></em></p>
                </div>

                {% if taxon.variety_notes %}
                <div class="section">
                    <h5>Notes on Subspecies and Varieties:</h5>
                    <p>{{ taxon.variety_notes|safe }}</p>
                </div>
                {% endif %}
                
                <div class="section">
				    <h5 class="left help">Need Help?</h5>
                    <a href="{% url simplekey-help-start %}"
                        class="get-help-btn left">Get Help</a>
				    <div class="clearit"></div>
			    </div>
            </div>
            
            <div class="clearit"></div>
        </div>
    </div>
{% endblock %}
