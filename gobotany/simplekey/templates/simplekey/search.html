{% extends "simplekey/_new_base.html" %}
{% load gobotany_tags %}
{% load humanize %}
{% load search_highlight %}
{% load simplekey_extras %}

{% block title %}{{ query }}: Search{% endblock %}

{% block js_require %}
    require(['simplekey/search']);
{% endblock %}

{% block body_attributes %}
    id="search-results" class="app search-results"
{% endblock %}

{% block body_content %}
    {% include "simplekey/_header.html" %}

    <div class="content">
        <div class="container">
            <div id="main">
                <h2>
                    {% if paginator.count > 0 %}
                        {% if page.number > 1 %}
                            Page {{ page.number }} of 
                        {% endif %}
                        {{ paginator.count|intcomma }}
                    {% else %}
                        No
                    {% endif %}
                    result{% if paginator.count != 1 %}s{% endif %}
                    for
                    <strong>{{ query }}</strong>
                </h2>

                <ul id="search-results-list">    
                {% for result in page.object_list %}
                    <li>
                        {% search_highlight result.title with query as item_title excerpt 'False' %}
                        <a href="{{ result.url }}">
                        {% if result.model_name == 'taxon' %}
                            <img
                                src="/static/images/icons/icon-leaf.png"
                                alt="" title="Species page">
                            {{ item_title|italicize_plant|safe }}
                        {% endif %}
                        {% if result.model_name == 'family' %}
                            <img
                                src="/static/images/icons/icon-family.png"
                                alt="" title="Family page">
                                {{ item_title }}
                        {% endif %}
                        {% if result.model_name == 'genus' %}
                            <img
                                src="/static/images/icons/icon-genus.png"
                                alt="" title="Genus page">
                                {{ item_title|italicize_plant|safe }}
                        {% endif %}
                        {% if result.model_name == 'plainpage' %}
                            <img
                                src="/static/images/icons/icon-help.png"
                                alt="" title="Help page">
                                {{ item_title }}
                        {% endif %}
                        {% if result.model_name == 'glossarypage' %}
                            <img
                                src="/static/images/icons/icon-glossary.png"
                                alt="" title="Glossary page">
                                {{ item_title }}
                        {% endif %}
                        {% if result.model_name == 'groupslistpage' %}
                            <img
                                src="/static/images/icons/icon-groups-list.png"
                                alt="" title="Simple Key plant groups page">
                                {{ item_title }}
                        {% endif %}
                        {% if result.model_name == 'subgroupslistpage' %}
                            <img src="/static/images/icons/icon-groups-list.png"
                                alt="" title="Simple Key plant subgroups page">
                                {{ item_title }}
                        {% endif %}
                        {% if result.model_name == 'subgroupresultspage' %}
                            <img src="/static/images/icons/icon-grid.png"
                                alt=""
                                title="Simple Key plant group results page">
                                {{ item_title }}
                        {% endif %}
                        </a>
                        <p>
                        {% search_highlight result.text with query as result_excerpt ignore_between '\n--\n' %}{{ result_excerpt }}
                        </p>
                    </li>
                {% endfor %}
                </ul>

                {% if page.object_list|length == 0 %}
                    <p>Please adjust your search and try again.</p>
                {% else %}
                    <div class="search-navigation">
                        <ul>
                        {% if page.has_previous %}
                            <li><a href="?q={{ query }}&amp;page={{ page.previous_page_number }}">Previous</a></li>
                        {% endif %}

                        {# Set a maximum number of pages to display. #}
                        {% for page_num in paginator.page_range|slice:':20' %}
                            {% if page_num == page.number %}
                                <li>{{ page_num }}</li>
                            {% else %}
                            <li><a href="?q={{ query }}&amp;page={{ page_num }}">{{ page_num }}</a></li>
                            {% endif %}
                        {% endfor %}
                        {# Display ellipsis if omitting some pages. #}
                        {% if paginator.page_range|length > 20 %}
                            <li>...</li>
                        {% endif %}

                        {% if page.has_next %}
                            <li><a href="?q={{ query }}&amp;page={{ page.next_page_number }}">Next</a></li>
                        {% endif %}
                        </ul>
                    </div>
                {% endif %}
            </div>

            <div id="sidebar">
                {% include "simplekey/_sidebar_items.html" %}
            </div>
            <div class="clearit"></div>
        </div>
    </div>
{% endblock %}
